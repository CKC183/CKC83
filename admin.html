<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Control Center</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body style="background: #f4f7f6;">

    <div class="container">
        <header style="display: flex; justify-content: space-between; align-items: center; padding: 20px 0;">
            <h2>ğŸ›  Admin Control Panel</h2>
            <button onclick="location.href='index.html'" class="btn-outline">Shop á€á€­á€¯á€·á€á€½á€¬á€¸á€›á€”á€º</button>
        </header>

        <div class="form-box shadow" style="background:white; padding:25px; border-radius:15px;">
            <h3>â• á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€™á€Šá€º</h3>
            <div style="display: grid; gap: 10px;">
                <input type="text" id="pName" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º" class="form-control">
                <input type="number" id="pPrice" placeholder="á€…á€»á€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (MMK)" class="form-control">
                
                <input type="text" id="pCat" list="category-options" placeholder="á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸ (á€¥á€•á€™á€¬- á€˜á€®á€šá€¬áŠ á€¡á€€á€»á€®)" class="form-control">
                <datalist id="category-options">
                    <option value="á€˜á€®á€šá€¬">
                    <option value="á€–á€»á€±á€¬á€ºá€›á€Šá€º">
                    <option value="á€™á€¯á€”á€·á€º">
                </datalist>

                <input type="number" id="pStock" placeholder="Stock á€¡á€›á€±á€¡á€á€½á€€á€º" class="form-control">
                <input type="text" id="pImg" placeholder="á€•á€¯á€¶ Link (Direct Link)" class="form-control">
                
                <button class="btn-primary" onclick="addProduct()" style="padding: 12px;">á€•á€…á€¹á€…á€Šá€ºá€¸á€á€„á€ºá€™á€Šá€º</button>
            </div>
        </div>

        <hr style="margin: 30px 0;">

        <h3>ğŸ“¦ á€œá€€á€ºá€›á€¾á€­á€á€„á€ºá€‘á€¬á€¸á€á€±á€¬ á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸</h3>
        <div id="admin-list" class="admin-grid" style="margin-top:20px;">
            <p style="text-align: center;">Loading...</p>
        </div>
    </div>

    <script>
        // áá‹ Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyD0oFN72HDNioauZHRyPd3Oh_I04abNgDs",
            authDomain: "marker1-6736f.firebaseapp.com",
            projectId: "marker1-6736f",
            storageBucket: "marker1-6736f.firebasestorage.app",
            messagingSenderId: "886941886218",
            appId: "1:886941886218:web:aac97e95f46682924ffcf3"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // á‚á‹ á€œá€¯á€¶á€á€¼á€¯á€¶á€›á€±á€¸á€¡á€á€½á€€á€º Admin á€Ÿá€¯á€á€ºá€™á€Ÿá€¯á€á€º á€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸
        auth.onAuthStateChanged(user => {
            if (user) {
                // admin@gmail.com á€–á€¼á€…á€ºá€™á€¾ á€•á€±á€¸á€á€„á€ºá€™á€Šá€º
                if (user.email === "admin@gmail.com") {
                    loadAdminProducts();
                } else {
                    alert("á€á€„á€ºá€á€Šá€º Admin á€™á€Ÿá€¯á€á€ºá€•á€«á€á€–á€¼á€„á€·á€º á€á€„á€ºá€á€½á€„á€·á€ºá€™á€›á€¾á€­á€•á€«á‹");
                    window.location.href = "index.html";
                }
            } else {
                // Login á€™á€á€„á€ºá€‘á€¬á€¸á€œá€»á€¾á€„á€º Login Page á€á€­á€¯á€· á€•á€­á€¯á€·á€™á€Šá€º
                window.location.href = "login.html";
            }
        });

        // áƒá‹ á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€á€„á€ºá€á€¼á€„á€ºá€¸
        async function addProduct() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const cat = document.getElementById('pCat').value;
            const stock = document.getElementById('pStock').value;
            const img = document.getElementById('pImg').value;

            if (!name || !price || !cat || !img) {
                return alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€¡á€¬á€¸á€œá€¯á€¶á€¸ á€–á€¼á€Šá€·á€ºá€•á€±á€¸á€•á€«");
            }

            try {
                await db.collection("products").add({
                    name: name,
                    price: Number(price),
                    category: cat,
                    stock: Number(stock) || 0,
                    image: img,
                    createdAt: new Date().getTime() // á€…á€®á€›á€”á€ºá€¡á€á€½á€€á€º á€¡á€á€»á€­á€”á€ºá€™á€¾á€á€ºá€á€¬á€¸á€á€¼á€„á€ºá€¸
                });

                alert("á€•á€…á€¹á€…á€Šá€ºá€¸á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®");
                location.reload();
            } catch (e) {
                alert("á€á€„á€ºá€™á€›á€•á€«: " + e.message);
            }
        }

        // á„á‹ á€•á€…á€¹á€…á€Šá€ºá€¸á€…á€¬á€›á€„á€ºá€¸á€•á€¼á€á€á€¼á€„á€ºá€¸á€”á€¾á€„á€·á€º á€–á€»á€€á€ºá€á€¼á€„á€ºá€¸
        function loadAdminProducts() {
            db.collection("products").orderBy("createdAt", "desc").onSnapshot(snap => {
                const list = document.getElementById("admin-list");
                if (!list) return;

                list.innerHTML = snap.docs.map(doc => {
                    const p = doc.data();
                    return `
                        <div class="admin-item shadow" style="display:flex; justify-content:space-between; align-items:center; background:white; padding:15px; margin-bottom:12px; border-radius:12px; border-left: 5px solid #007bff;">
                            <div style="display:flex; align-items:center; gap:15px;">
                                <img src="${p.image}" style="width:60px; height:60px; border-radius:10px; object-fit:cover;" onerror="this.src='https://via.placeholder.com/60'">
                                <div>
                                    <strong style="display:block; font-size: 16px;">${p.name}</strong>
                                    <small style="color:gray;">${p.price} MMK | ${p.category} | Stock: ${p.stock}</small>
                                </div>
                            </div>
                            <button onclick="deleteProduct('${doc.id}')" style="background:#ff4757; color:white; border:none; padding:10px 18px; border-radius:10px; cursor:pointer; font-weight: bold;">á€–á€»á€€á€ºá€™á€Šá€º</button>
                        </div>
                    `;
                }).join('') || "<p style='text-align:center;'>á€•á€…á€¹á€…á€Šá€ºá€¸á€…á€¬á€›á€„á€ºá€¸á€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹</p>";
            }, error => {
                if (error.code === 'permission-denied') {
                    console.log("Permission denied. Check Firebase Rules.");
                }
            });
        }

        // á…á‹ á€•á€…á€¹á€…á€Šá€ºá€¸á€–á€»á€€á€ºá€á€¼á€„á€ºá€¸
        async function deleteProduct(id) {
            if (confirm("á€’á€®á€•á€…á€¹á€…á€Šá€ºá€¸á€€á€­á€¯ á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
                try {
                    await db.collection("products").doc(id).delete();
                    alert("á€–á€»á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®");
                } catch (e) {
                    alert("á€–á€»á€€á€ºá€™á€›á€•á€«: " + e.message);
                }
            }
        }
    </script>

    <style>
        .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-primary { background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-outline { background: transparent; border: 1px solid #007bff; color: #007bff; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        .shadow { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .hidden { display: none; }
    </style>
</body>
</html>
