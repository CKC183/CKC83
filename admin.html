<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <div class="form-box shadow" style="background:white; padding:20px; border-radius:15px; margin-top:20px;">
            <h3>➕ ပစ္စည်းအသစ်ထည့်မည်</h3>
            <input type="text" id="pName" placeholder="ပစ္စည်းအမည်">
            <input type="number" id="pPrice" placeholder="စျေးနှုန်း">
            
            <p style="font-size: 14px; margin-bottom: 5px;">အမျိုးအစား (ရိုက်ထည့်ပါ သို့မဟုတ် ရွေးပါ):</p>
            <input type="text" id="pCat" list="category-options" placeholder="အမျိုးအစား">
            <datalist id="category-options">
                <option value="အကျီ"><option value="ဘောင်းဘီ"><option value="ဖိနပ်"><option value="အိတ်">
            </datalist>

            <input type="number" id="pStock" placeholder="Stock အရေအတွက်">
            <input type="text" id="pImg" placeholder="ပုံ Link (Direct Link)">
            <button class="btn-primary" onclick="addProduct()">ပစ္စည်းတင်မည်</button>
            <button onclick="location.href='index.html'" class="btn-outline">Shop သို့သွားရန်</button>
        </div>

        <div id="admin-list" class="admin-grid" style="margin-top:20px;"></div>
    </div>

    <script>
    const firebaseConfig = {
    apiKey: "AIzaSyD0oFN72HDNioauZHRyPd3Oh_I04abNgDs",
    authDomain: "marker1-6736f.firebaseapp.com",
    projectId: "marker1-6736f",
    storageBucket: "marker1-6736f.firebasestorage.app",
    messagingSenderId: "886941886218",
    appId: "1:886941886218:web:aac97e95f46682924ffcf3"
  };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ၁။ ပစ္စည်းတင်တဲ့ Function
    async function addProduct() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const cat = document.getElementById('pCat').value;
        const stock = document.getElementById('pStock').value;
        const img = document.getElementById('pImg').value;

        if (!name || !price || !cat || !img) {
            return alert("အချက်အလက်အားလုံး ဖြည့်ပေးပါ");
        }

        try {
            await db.collection("products").add({
                name: name,
                price: Number(price),
                category: cat,
                stock: Number(stock) || 0,
                image: img,
                createdAt: new Date().getTime() // အချိန်ကို Number အဖြစ်သိမ်းလိုက်ခြင်း (Error ကင်းစေရန်)
            });

            alert("ပစ္စည်းတင်ပြီးပါပြီ");
            location.reload(); // စာမျက်နှာကို refresh လုပ်ပြီး စာရင်းပြန်ပြမည်
        } catch (e) {
            alert("တင်မရပါ: " + e.message);
        }
    }

    // ၂။ ပစ္စည်းစာရင်းကို ဆွဲထုတ်ပြီး ဖျက်လို့ရအောင်လုပ်ခြင်း
    function loadAdminProducts() {
        // createdAt မရှိတဲ့ data တွေကြောင့် error မတက်အောင် ရိုးရိုးပဲ ဆွဲထုတ်ပါမယ်
        db.collection("products").onSnapshot(snap => {
            const list = document.getElementById("admin-list");
            if (!list) return;

            list.innerHTML = snap.docs.map(doc => {
                const p = doc.data();
                return `
                    <div class="admin-item shadow" style="display:flex; justify-content:space-between; align-items:center; background:white; padding:15px; margin-bottom:10px; border-radius:10px;">
                        <div style="display:flex; align-items:center; gap:15px;">
                            <img src="${p.image}" style="width:50px; height:50px; border-radius:8px; object-fit:cover;">
                            <div>
                                <strong style="display:block;">${p.name}</strong>
                                <small style="color:gray;">${p.price} MMK | ${p.category}</small>
                            </div>
                        </div>
                        <button onclick="deleteProduct('${doc.id}')" style="background:#ff4757; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">ဖျက်မည်</button>
                    </div>
                `;
            }).join('') || "<p style='text-align:center;'>ပစ္စည်းစာရင်းမရှိသေးပါ။</p>";
        });
    }

    // ၃။ ပစ္စည်းဖျက်တဲ့ Function
    async function deleteProduct(id) {
        if (confirm("ဒီပစ္စည်းကို ဖျက်မှာ သေချာပါသလား?")) {
            try {
                await db.collection("products").doc(id).delete();
                alert("ဖျက်ပြီးပါပြီ");
            } catch (e) {
                alert("ဖျက်မရပါ: " + e.message);
            }
        }
    }

    // စာမျက်နှာ စဖွင့်တာနဲ့ ပစ္စည်းစာရင်းပြမည်
    loadAdminProducts();
</script>

